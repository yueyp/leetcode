<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        /*
            1. 调用 task 方法往队列里面添加任务
            2. 调用 start 方法依次执行任务，执行完毕清空队列
            3. 支持链式调用

            new Queue()
            .task(1000, () => {
                console.log(1);
            })
            .task(2000, () => {
                console.log(2);
            })
            .task(1000, () => {
                console.log(3);
            })
            .start();
        */
        // 方法一
        // function Queue(){
        //     this.queue = []
        // }

        // Queue.prototype.task = function(time,callback){
        //     this.queue.push({time,callback})
        //     return this
        // }
        // Queue.prototype.start = function(){
        //     const queue = this.queue
        //     let result = Promise.resolve()

        //     queue.forEach((item) => {
        //         result = result.then(() => {
        //             return new Promise((resolve,reject) => {
        //                 setTimeout(() => {
        //                     resolve(item.callback())
        //                 },item.time)
        //             })
        //         })
        //     })
        //     return result
        // }
        // 方法二
        class Queue {
            constructor() {
                this.tasks = []
            }
            task(wait, fn) {
                this.tasks.push([wait, fn])
                return this
            }
            start() {
                var fn = () => {
                    let arg = this.tasks.shift()
                    if (arg) {
                        setTimeout(() => {
                            arg[1].call()
                            fn()
                        }, arg[0])
                    }
                }
                fn()
            }
        }
        // new Queue()
        //     .task(1000, () => {
        //         console.log(1);
        //     })
        //     .task(2000, () => {
        //         console.log(2);
        //     })
        //     .task(1000, () => {
        //         console.log(3);
        //     })
        //     .start();
    </script>
</body>

</html>